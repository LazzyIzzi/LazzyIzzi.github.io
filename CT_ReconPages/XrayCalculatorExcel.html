<title>X-ray Calculator Excel</title>
<link rel="icon" type="image/x-icon" href="../SiteImages/LazzyIzzi.jpg">

<h1>X-ray Calculator Excel</h1>
<h3>Requires Excel 2013 or better. It was tested running
	Windows-11. I don't know if it will work on a Mac.</h3>
<h2>
	<a href="../index.html" target="_self"><em><strong>Home</strong></em></a>
</h2>


<h3>The MuMassCalculator.xlam AddIn provides functions and macros
	for getting the attenuation properties of atoms and compounds.</h3>
<p>
	Installation: <strong>NIST_XCOM.xlam&nbsp;</strong>is available for
	download <a
		href="https://github.com/LazzyIzzi/MuMassCalculatorExcel/blob/main/NIST_XCOM.xlam"
		target="_blank">here</a>. Place it in a folder where Excel can find
	it, on a PC usually
	C:\Users\YourUserName\AppData\Roaming\Microsoft\AddIns\ <br>Start
	Excel. In the DEVELOPER tab click the Add-Ins icon. In the Dialog check
	NIST_XCOM. Click OK. <br>An ADD-INS tab should appear in the
	ribbon. <br>
	<em>Special Note: Downloading Excel add-ins and macro enabled
		workbooks can be dangerous due to the possibility of embedded malware.
		Newer versions of Excel provide significant protection. Please take
		appropriate precautions before enabling any downloaded Excel workbook.
		This add-in file size after download should be 1,100,188 bytes and
		1,101,824 bytes on disk.</em>
</p>

<center>
	<figure class="easyimage easyimage-full">
		<img alt="" src="../CT_ReconImages//Excel/NIST_XCOM_Local_Properties.png"
			width="300" />
		<figcaption>
			<strong>NIST_XCOM.xlam File Size on disk</strong>
		</figcaption>
	</figure>
</center>

<p>To use the functions, Select an output cell(s), Click the
	FORMULAS tab and then click the Insert Function icon. Fill in the required data and click OK.
<center>
	<figure class="easyimage easyimage-full">
		<img alt="" src="../CT_ReconImages//Excel/InsertFunction-1.png" width="300" />
		<figcaption>
			<strong>Select X-ray Functions.</strong>
		</figcaption>
	</figure>
</center>
<center>
	<figure class="easyimage easyimage-full">
		<img alt="" src="../CT_ReconImages//Excel/InsertFunction-2.png" width="400" />
		<figcaption>
			<strong>Select the function you want to use.</strong>
		</figcaption>
	</figure>
</center>
<center>
	<figure class="easyimage easyimage-full">
		<img alt="" src="../CT_ReconImages//Excel/InsertFunction-3.png" width="400" />
		<figcaption>
			<strong>Select the input cells. Click OK.</strong>
		</figcaption>
	</figure>
</center>
<center>
	<figure class="easyimage easyimage-full">
		<img alt="" src="../CT_ReconImages//Excel/InsertFunction-4.png" width="200" />
		<figcaption>
			<strong>View the results.</strong>
		</figcaption>
	</figure>
</center>

<h3>Excel Array Functions</h3>
<p>GetFormualMevFromMuLin and GetFormualMevFromMuLinRatio functions
	return arrays. This is noted in their input dialogs. Select at least two
	contiguous row cells for output before calling the function. <strong>Do Not</strong>
	click OK in the function dialog. Use Ctrl-Shift-Enter to execute the
	function. The first value returned is the number of solutions. The contiguous row cells should be the number of solutions + 1.</p>

<h3>Excel Macros</h3>
<p>To use the macros, Click the ADD-INS tab, GetSpectrum and
	BeamHardening should appear in the Toolbar Commands ribbon.
<H4>Get Spectrum</H4>
<P>Use the radio buttons to select Atom or Formula</P>

<p>Get Spectrum returns a list of absorption cross-section data for
	atoms or formulas over a selected energy range.</p>
<center>
	<figure class="easyimage easyimage-full">
		<img alt="" src="../CT_ReconImages//Excel/GetSpectrum_Atom.png" width="250" />
		<figcaption>
			<strong>Get Spectrum for an atom.</strong>
		</figcaption>
	</figure>
</center>
<p>The atoms can be listed by Symbol, Number, or Name. I prefer
	Name.</p>
<center>
	<figure class="easyimage easyimage-full">
		<img alt="" src="../CT_ReconImages//Excel/GetSpectrum_Formula.png" width="250" />
		<figcaption>
			<strong>Get Spectrum for a Formula.</strong>
		</figcaption>
	</figure>
</center>
<p>Formulas are entered manually using an Atom1:Count1:Atom2:Count2
	formatted Formula</p>
<ol>
	<li>Check the desired cross-sections</li>
	<li>Enter the desired energy range Min and Max</li>
	<li>Select the number of interpolated points to add to the output.
		This will create a separate list of N approximately log-spaced points
		in the selected range.</li>
	<li>Check Plot Spectrum if desired</li>
</ol>
<center>
	<figure class="easyimage easyimage-full">
		<img alt="" src="../CT_ReconImages//Excel/GetSpectrum_Formula_Result.png"
			width="600" />
		<figcaption>
			<strong>Data and spectrum for the Formula example.</strong>
		</figcaption>
	</figure>
</center>

<H4>Beam Hardening</H4>

<p>
	Please refer to the ImageJ <a href="CtScannerSetup.html"
		target="_blank"><em><strong>Scanner_Setup</strong></em></a> page for a
	description of how this Macro works.
</p>
<ol>
	<li>Select BeamHardening from the ADD-INS Toolbar Commands.</li>
	<li>Edit the Source, Sample, Detector, and Plot Range fields.</li>
	<li>Click Update Plot. The effective energy, sample tau,
		BeamHardening %, and photon efficiency % appear in the plot title.</li>
	<li>Twiddle the parameters to optimize the beam hardening and
		photon efficiency.</li>
	<li>OR enter the level of tolerable beam hardening in the Target
		BH% field and click Optimize to let the Solver maximize Photon Use%
		while constraining sample tau and beam hardening. Note: Increase the
		default 1 KeV plot increment to 5 KeV to speed up the solver.</li>
</ol>


<center>
	<figure class="easyimage easyimage-full">
		<img alt="" src="../CT_ReconImages//Excel/BeamHardening_Initial.png" width="600" />
		<figcaption>
			<strong>The Spectral distributions for the Settings.</strong>
		</figcaption>
	</figure>
</center>

<center>
	<figure class="easyimage easyimage-full">
		<img alt="" src="../CT_ReconImages//Excel/BeamHardening_Optimized.png" width="600" />
		<figcaption>
			<strong>The Optimized Spectral distributions a 10% Target
				BH.</strong>
		</figcaption>
	</figure>
</center>

<h2>
	<a href="../index.html" target="_self"><em><strong>Home</strong></em></a>
</h2>

